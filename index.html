<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lit without build steps</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Watch Files: Server Side Events -->
    <script>
        function startListeningForChanges() {
            const source = new EventSource('/watch');

            source.onmessage = function (event) {
                console.log(event);
                // The server sends a message when a change is detected
                if (event.data.trim() === 'update') {
                    window.location.reload(); // Reload the page if there's an update
                }
                // No need to manually schedule the next check as SSE keeps the connection open
            };

            source.onerror = function (error) {
                console.error('EventSource failed:', error);
                source.close(); // Close the connection if there's an error

                // Optionally, attempt to reconnect after a delay
                setTimeout(startListeningForChanges, 1000);
            };

            // Optional: Listen for custom events if your server sends them
            source.addEventListener('customEventName', function (e) {
                const data = JSON.parse(e.data);
                console.log('Received a custom event:', data);
                // Handle custom event data
            }, false);
        }

        // Start listening for changes when the page loads
        document.addEventListener('DOMContentLoaded', startListeningForChanges);
    </script>
    <script type="importmap">
        {
          "imports": {
            "lit": "https://cdn.jsdelivr.net/gh/lit/dist@3/core/lit-core.min.js",
            "@vaadin/router": "https://cdn.jsdelivr.net/npm/@vaadin/router"
          }
        }
    </script>
    <script type="module">
        import { LitElement, html, css } from 'lit';
        import { Router } from 'https://cdn.jsdelivr.net/npm/@vaadin/router';

        class HeaderComponent extends LitElement {
            static styles = css`/* Your CSS here */`;
            render() {
                return html`
                    <header>
                        <nav>
                            <button @click="${() => this.navigate('/')}">Home</button>
                            <button @click="${() => this.navigate('/about')}">About Us</button>
                        </nav>
                    </header>
                `;
            }
            navigate(path) {
                Router.go(path);
            }
        }
        customElements.define('header-component', HeaderComponent);

        class FooterComponent extends LitElement {
            render() {
                return html`<div>Just view source this page and you will see all of the code there, easy to follow and learn</div>`;
            }
        }
        customElements.define('footer-component', FooterComponent);

        class AppElement extends LitElement {
            createRenderRoot() {
                return this; // Render directly within the element
            }

            firstUpdated() {
                // Ensure the outlet div is selected correctly within the light DOM of this component
                const outlet = this.querySelector('#outlet');
                const router = new Router(outlet);
                router.setRoutes([
                    {
                        path: '/',
                        component: 'home-component',
                        action: async () => {
                            await import('./HomeComponent.js'); // Ensures AboutComponent is imported
                            return 'home-component'; // Return the tag name for rendering
                        },
                    },
                    {
                        path: '/about',
                        component: 'about-component',
                        action: async () => {
                            await import('./AboutComponent.js'); // Ensures AboutComponent is imported
                            return 'about-component'; // Return the tag name for rendering
                        },
                    },
                    { path: '(.*)', redirect: '/' },
                ]);
            }


            render() {
                return html`
                    <header-component></header-component>
                    <div id="outlet"></div> <!-- Router will render content here -->
                    <footer-component></footer-component>
                `;
            }
        }
        customElements.define('app-element', AppElement);
    </script>
</head>
<body>
<app-element></app-element>
</body>
</html>
